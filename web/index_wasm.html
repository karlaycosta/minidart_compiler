<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ MiniDart Compiler Web v1.4.1 - WebAssembly</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    ğŸš€ <span class="title-main">MiniDart Compiler</span>
                    <span class="title-version">v1.4.1 WebAssembly</span>
                </h1>
                <p class="subtitle">Compilador de linguagem educacional em portuguÃªs - Powered by WebAssembly</p>
                <div class="wasm-indicator">
                    <span id="wasm-status" class="wasm-status loading">ğŸ”„ Carregando WebAssembly...</span>
                </div>
            </div>
            
            <div class="controls">
                <button id="btn-compile" class="btn btn-primary" disabled>
                    <span class="btn-icon">â–¶ï¸</span>
                    Executar
                </button>
                <button id="btn-ast" class="btn btn-secondary" disabled>
                    <span class="btn-icon">ğŸŒ³</span>
                    Ver AST
                </button>
                <button id="btn-bytecode" class="btn btn-secondary" disabled>
                    <span class="btn-icon">âš™ï¸</span>
                    Bytecode
                </button>
                <button id="btn-clear" class="btn btn-outline">
                    <span class="btn-icon">ğŸ§¹</span>
                    Limpar
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel: Editor -->
            <div class="editor-panel">
                <div class="panel-header">
                    <h3 class="panel-title">ğŸ“ CÃ³digo MiniDart</h3>
                    <div class="editor-controls">
                        <select id="examples" class="select">
                            <option value="">Selecione um exemplo...</option>
                            <option value="hello">ğŸŒ OlÃ¡ Mundo</option>
                            <option value="calculator">ğŸ§® Calculadora</option>
                            <option value="conditions">ğŸ”€ Estruturas de Controle</option>
                            <option value="loops">ğŸ”„ Loops</option>
                            <option value="functions">ğŸ¯ FunÃ§Ãµes</option>
                            <option value="complex">ğŸš€ Exemplo Complexo</option>
                        </select>
                    </div>
                </div>
                
                <div class="editor-container">
                    <textarea id="code-editor" class="code-editor" placeholder="// Digite seu cÃ³digo MiniDart aqui...
// Exemplo:
var nome = &quot;Mundo&quot;;
imprimir &quot;OlÃ¡, &quot;;
imprimir nome;"></textarea>
                    <div class="editor-status">
                        <span id="line-count">1 linha</span>
                        <span id="char-count">0 caracteres</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Output -->
            <div class="output-panel">
                <div class="tabs">
                    <button class="tab active" data-tab="output">
                        <span class="tab-icon">ğŸ“¤</span>
                        SaÃ­da
                    </button>
                    <button class="tab" data-tab="ast">
                        <span class="tab-icon">ğŸŒ³</span>
                        AST
                    </button>
                    <button class="tab" data-tab="bytecode">
                        <span class="tab-icon">âš™ï¸</span>
                        Bytecode
                    </button>
                    <button class="tab" data-tab="errors">
                        <span class="tab-icon">âŒ</span>
                        Erros
                    </button>
                </div>
                
                <div class="tab-contents">
                    <div id="tab-output" class="tab-content active">
                        <div class="output-header">
                            <h4>ğŸ“¤ SaÃ­da da ExecuÃ§Ã£o</h4>
                            <button id="btn-copy-output" class="btn-copy" title="Copiar saÃ­da">ğŸ“‹</button>
                        </div>
                        <pre id="output-content" class="output-text">WebAssembly carregando... Aguarde para executar o cÃ³digo.</pre>
                    </div>
                    
                    <div id="tab-ast" class="tab-content">
                        <div class="output-header">
                            <h4>ğŸŒ³ Ãrvore SintÃ¡tica Abstrata</h4>
                            <button id="btn-copy-ast" class="btn-copy" title="Copiar AST">ğŸ“‹</button>
                        </div>
                        <pre id="ast-content" class="output-text">AST serÃ¡ gerada quando vocÃª executar o cÃ³digo...</pre>
                    </div>
                    
                    <div id="tab-bytecode" class="tab-content">
                        <div class="output-header">
                            <h4>âš™ï¸ Bytecode Gerado</h4>
                            <button id="btn-copy-bytecode" class="btn-copy" title="Copiar bytecode">ğŸ“‹</button>
                        </div>
                        <pre id="bytecode-content" class="output-text">Bytecode serÃ¡ gerado quando vocÃª executar o cÃ³digo...</pre>
                    </div>
                    
                    <div id="tab-errors" class="tab-content">
                        <div class="output-header">
                            <h4>âŒ Erros de CompilaÃ§Ã£o</h4>
                            <button id="btn-copy-errors" class="btn-copy" title="Copiar erros">ğŸ“‹</button>
                        </div>
                        <pre id="errors-content" class="output-text">Nenhum erro encontrado.</pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>Â© 2025 <strong>Deriks Karlay Dias Costa</strong> | MiniDart Compiler v1.4.1 WebAssembly</p>
                <div class="footer-links">
                    <a href="https://github.com/karlaycosta/minidart_compiler" target="_blank">GitHub</a>
                    <span>â€¢</span>
                    <a href="#" id="link-about">Sobre</a>
                    <span>â€¢</span>
                    <a href="#" id="link-help">Ajuda</a>
                    <span>â€¢</span>
                    <span id="wasm-info">WebAssembly Ready</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <!-- <div id="loading" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Processando com WebAssembly...</p>
        </div>
    </div> -->

    <!-- About Modal -->
    <!-- <div id="modal-about" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸš€ Sobre o MiniDart Compiler WebAssembly</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>MiniDart WebAssembly</strong> Ã© uma versÃ£o otimizada do compilador que usa WebAssembly para mÃ¡xima performance.</p>
                
                <h4>âœ¨ CaracterÃ­sticas WebAssembly:</h4>
                <ul>
                    <li>ğŸš€ Performance nativa no navegador</li>
                    <li>âš¡ ExecuÃ§Ã£o mais rÃ¡pida que JavaScript</li>
                    <li>ğŸ”§ CompilaÃ§Ã£o ahead-of-time (AOT)</li>
                    <li>ğŸŒ Suporte universal em navegadores modernos</li>
                    <li>ğŸ“¦ Bundle menor e mais eficiente</li>
                </ul>

                <h4>ğŸ› ï¸ Tecnologias:</h4>
                <ul>
                    <li>Dart 3.8+ com suporte WebAssembly</li>
                    <li>WASM para execuÃ§Ã£o nativa</li>
                    <li>HTML5 + CSS3 para interface</li>
                    <li>Arquitetura modular e extensÃ­vel</li>
                </ul>
                
                <h4>ğŸ“Š Performance:</h4>
                <ul>
                    <li>InicializaÃ§Ã£o mais rÃ¡pida</li>
                    <li>Menor uso de memÃ³ria</li>
                    <li>ExecuÃ§Ã£o otimizada</li>
                </ul>
            </div>
        </div>
    </div> -->

    <!-- Carregar WebAssembly -->
    <script type="module">
        import { compileStreaming } from './main.mjs';
        
        // Indicador de status do WebAssembly
        const wasmStatus = document.getElementById('wasm-status');
        const wasmInfo = document.getElementById('wasm-info');
        const buttons = document.querySelectorAll('.btn:not(.btn-outline)');
        
        async function loadWasm() {
            try {
                wasmStatus.textContent = 'ğŸ”„ Carregando WebAssembly...';
                wasmStatus.className = 'wasm-status loading';
                
                // Verificar se WebAssembly Ã© suportado
                if (typeof WebAssembly === 'undefined') {
                    throw new Error('WebAssembly nÃ£o Ã© suportado neste navegador');
                }
                
                // Carregar e compilar o mÃ³dulo WebAssembly usando a API correta
                console.log('Fetching WebAssembly module...');
                const wasmResponse = fetch('./main.wasm');
                
                console.log('Compiling WebAssembly...');
                const compiledApp = await compileStreaming(wasmResponse);
                
                console.log('Instantiating WebAssembly...');
                // Instanciar o mÃ³dulo
                const instantiatedApp = await compiledApp.instantiate();
                
                // WebAssembly carregado com sucesso
                wasmStatus.textContent = 'âœ… WebAssembly Carregado';
                wasmStatus.className = 'wasm-status success';
                wasmInfo.textContent = 'WebAssembly Active';
                
                // Habilitar botÃµes
                buttons.forEach(btn => btn.removeAttribute('disabled'));
                
                // Atualizar mensagem inicial
                document.getElementById('output-content').textContent = 
                    'WebAssembly carregado! Clique em "Executar" para ver a saÃ­da do seu programa...';
                
                console.log('ğŸš€ MiniDart WebAssembly carregado com sucesso!');
                
                // Inicializar a aplicaÃ§Ã£o invocando main
                console.log('Invoking main...');
                instantiatedApp.invokeMain();
                
            } catch (error) {
                console.error('Erro detalhado ao carregar WebAssembly:', error);
                wasmStatus.textContent = 'âŒ Erro ao carregar WebAssembly';
                wasmStatus.className = 'wasm-status error';
                wasmInfo.textContent = 'WebAssembly Error';
                
                // Fallback para JavaScript
                document.getElementById('output-content').textContent = 
                    `Erro no WebAssembly: ${error.message}\nCarregando versÃ£o JavaScript...`;
                
                // Carregar versÃ£o JavaScript como fallback
                const script = document.createElement('script');
                script.src = 'main.dart.js';
                script.onload = () => {
                    console.log('JavaScript fallback carregado com sucesso');
                    // Habilitar botÃµes mesmo no fallback
                    buttons.forEach(btn => btn.removeAttribute('disabled'));
                    document.getElementById('output-content').textContent = 
                        'Usando versÃ£o JavaScript. Clique em "Executar" para ver a saÃ­da do seu programa...';
                };
                document.head.appendChild(script);
            }
        }
        
        // Carregar WebAssembly quando a pÃ¡gina estiver pronta
        loadWasm();
    </script>
</body>
</html>
